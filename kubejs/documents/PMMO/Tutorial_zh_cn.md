> 在Project MMO的2.0更新中，该模组对代码进行了重构。虽保留了核心机制，但实现细节和配置方式都发生了很大变化。本文将在Wiki翻译的基础上，结合深入研究和与原作者多次的交谈与查证，为大家提供详尽的魔改指导。

# Project MMO 2.0 更新指南

- [Project MMO 2.0 更新指南](#project-mmo-20-更新指南)
  - [文件结构](#文件结构)
    - [结构概览](#结构概览)
  - [经验](#经验)
  - [事件](#事件)
  - [技能](#技能)
    - [使用技能系统](#使用技能系统)
    - [如何定义技能](#如何定义技能)
      - [翻译技能名](#翻译技能名)
      - [技能显示颜色与AFK惩罚](#技能显示颜色与afk惩罚)
      - [技能组的配置选项：使用技能总和与显示组名](#技能组的配置选项使用技能总和与显示组名)
      - [技能组](#技能组)
      - [等级上限](#等级上限)
      - [图标与图标尺寸](#图标与图标尺寸)
      - [一个技能的完整配置示例:](#一个技能的完整配置示例)
  - [需求](#需求)

## 文件结构
> 我的世界实例的文件结构应为: 启动器所在文件夹/.minecraft/version/游戏版本文件夹/或启动器所在文件夹/.minecraft/，该情况仅限于常见的启动器，如有其他启动器有不同的情况欢迎在评论中补充。

> 本教程所使用模组版本为pmmo-1.20.1-1.3.22。

- 文件结构的改动是对于玩家来说最直观的。
- 在2.0版本中，原本位于config/pmmo/文件夹中的配置被更改为了数据包与服务端配置文件；
- 其中一些较为基础的全局配置与客户端配置存储于config/pmmo-common.toml与config/pmmo-client.toml中。
- 其余的部分则存储于Serverconfig或需要使用数据包来定义。

### 结构概览

.minecraft/<br>
├── configs/<br>
│   ├── pmmo-client.toml **控制技能、经验获取、工具提示与连锁挖矿相关的显示。**<br>
│   └── pmmo-common.toml **调试用，通常该配置文件无需被使用。**<br>
└── saves/<br>
    └── world/ **你的存档名，通常你可以将此处的配置文件存于defaultconfigs/**<br>
        └── serverconfig/<br>
            ├── pmmo-AntiCheese.toml **反作弊相关设置，默认加入了未开启的钓鱼反作弊。**<br>
            ├── pmmo-AutoValues.toml **通过该文件的配置**<br>
            **可以自动根据物品、方块和实体的属性与为物品、方块和实体设置`使用需求`与`经验值获取`的值。**<br>
            **会被数据包覆盖。**<br>
            ├── pmmo-Globals.toml **当前用于简写数据包中NBT的Path**<br>
            **constants当前未实现任何功能。**<br>
            ├── pmmo-Perks.toml **控制玩家在提升等级时获取的收益以及等级为玩家带来的属性上的成长**<br>
            **可在此处禁用烟花火箭。**<br>
            ├── pmmo-Skills.toml **定义技能的最高等级与其显示的图标。**<br>
            └── pmmo-server.toml **所有该模组的核心配置都存放于此处**<br>
            **包括但不限于全局的经验获取速率、升级所需经验、经验获取的方式**<br>
            **以及各种`需求`的开关。**<br>
            **团队经验增益、怪物增强与连锁挖矿也可在此处配置**<br>

> 最基础的设置可通过[该软件](https://github.com/SomewhatDamaged/PMMO-Simple-Config)访问存档文件夹来直接修改

## 经验

- Project MMO的所有机制都与经验有关。通过游戏中的行为/事件可以获得经验，这些经验将在积累后使特定技能升级。
  特定技能的等级又被用作配置某些行为的`需求`。所有形式的`经验获取`和`需求`都是**可配置的**。
- 假设破坏一个石块会为玩家带来1点采矿经验。如果他们破坏了10个石块，他们将获得10点经验。
  现在假设使用石制镐需要采矿等级2。如果等级2需要20点经验，那么他们将需要再破坏10个石块才能使用石制镐。
- 有许多事件可以用来给玩家奖励经验，该部分内容将会在后文中补充。

## 事件

- 事件是PMMO监控的多种行为，会在游戏中为玩家提供不同技能的经验。
在所有情况下，玩家被授予的经验值都基于与该事件相关的物品、方块或实体的配置。
- 某些事件可以被阻止/妨碍或限制。有关`需求`的更多信息，请参见有关`需求`的教程。

**以下是PMMO中的所有事件：**

|事件名称|描述|需求|奖励|
|:---|:---:|:---:|:---:|
|**铁砧修复**|当玩家使用铁砧修复物品时触发|无|从物品的数据包配置中获取固定的经验值|
|**破坏方块**|当一个方块被破坏时（未将方块破坏的挖掘不会触发该事件）触发|`破坏`(方块)|由方块的数据包配置定义，受 `pmmo-server.toml` 中 `重复挖掘` 设置的影响，玩家挖掘自己放下的方块时减少获取的经验值|
|**破坏速度**|该事件被奖励系统`Perks`用于控制方块被玩家破坏的速度，会在方块被破坏前检查需求|`工具`(物品) 和 `方块`(方块)|无|
|**放置方块**|当方块被玩家放置时触发|`放置`(方块)|由方块的数据包配置定义|
|**呼吸**|当玩家的氧气槽增加或减少时触发|无|在 `pmmo-server.toml` 中配置|
|**繁殖**|当动物被玩家喂食并因此繁殖出幼崽时触发|`繁殖`(实体)|从实体的数据包配置中获得固定的数值|
|**酿造**|当酿造台中酿造好的药水被玩家取出时触发|无|由物品的数据包配置定义（因配置输出物品，而非材料）|
|**消耗**|当药水或食物被玩家饮用或食用时|`食用`|从物品的数据包配置中获取固定的经验值|
|**制作**|当物品被制作时|无|从物品的数据包配置中获取固定的经验值|
|**蹲伏**|玩家每10刻的一次蹲伏（快速按下与松开Shift）触发|无|仅用于奖励系统`Perks`|
|**受到伤害**|当玩家受到伤害时触发|无|根据造成伤害的实体来定义。如果是近战攻击，则为该实体；如果是远程攻击，则为投射物。如果该事件中无法获取到实体数据，可以在 `pmmo-server.toml` 中配置，来根据伤害类型来定义受伤时获取的经验类型/值。注意，该处的设置中，经验值根据伤害类型来区分，此处设置的数值会乘以玩家实际受到的伤害值（在护甲、附魔的减伤计算后）|
|**造成伤害**|当玩家造成近战伤害时触发触发|`武器`(物品) 和 `击杀`(实体)|结合玩家所持物品的数据包配置、受伤实体的数据包配置以及（或）投射物的数据。如果这三者都没有在数据包中进行伤害相关的配置，则使用 `pmmo-server.toml` 中的设置作为备用选项。玩家实际获取的经验值会乘以实际造成的伤害值（同样经过减伤效果后）|
|**死亡**|当实体因玩家而死亡时（注意，此时造成伤害和死亡的事件都会被触发，且可有不同的设置）触发|`武器`(物品) 和 `击杀`(实体)|在死亡实体的数据包配置中定义|
|**附魔**|当物品在附魔台上被附魔时触发|无|从物品的数据包中获取（配置的经验值会根据每个附魔的最大等级进行缩放。如果数据包中配置的值为100经验值且附魔的最高等级为1，那么等级1的附魔将给你100经验值。如果附魔的最高等级为3且你获得了等级1的附魔，你将获得33经验值。如果同时获得了这两个附魔，总共将获得133经验值）|
|**效果**|玩家在有任意激活中的药水效果时每10刻触发|无|在效果的数据包配置中定义|
|**钓鱼**|当玩家通过钓鱼获得物品时触发|`工具`(物品)|根据每个战利品物品的数据包配置，授予所有战利品物品的经验值总和|
|**熔炼**|当玩家在原版熔炉中熔炼物品时，将物品放置于熔炉的玩家触发|无|从原材料的数据包配置中获取|
|**生长**|当作物的生长阶段增进一级时，放置作物的玩家触发|无|从方块的数据包配置中获取|
|**生命值变化**|当玩家的生命值增加或减少时触发|无|在 `pmmo-server.toml` 中设置|
|**跳跃**|当玩家进行跳跃时触发|无|在 `pmmo-server.toml` 中定义|
|**冲刺加跳跃**|当玩家在冲刺时进行跳跃触发|无|在 `pmmo-server.toml` 中设置|
|**蹲伏加跳跃**|当玩家在蹲伏时进行跳跃触发|无|在 `pmmo-server.toml` 中设置|
|**左键方块**|当玩家左键方块时触发。与 `破坏速度` 事件类似，但不能修改破坏速度且在创造模式下该事件也会在玩家将方块破坏前被触发|`互动`(方块) 和 `互动`(物品)|从方块的数据包配置中获取|
|**激活方块**|当方块被玩家互动并因此被激活时（如按下按钮或拉下拉杆）触发|`互动`(方块) 和 `互动`(物品) 当持有物品与方块互动时|在方块的数据包配置来中定义该事件的行为，在物品的数据包配置中定义其在方块上使用的行为|
|**激活物品**|当物品被玩家右键点击（或激活）时触发|`使用`(物品)|从物品的数据包配置中获取|
|**交互**|当玩家与实体交互时触发，如剪羊毛或与村民交易|`实体互动`(实体)|从实体的数据包配置中获取|
|**骑乘**|玩家乘在任何交通工具（马、船、矿车等）上时，每10刻触发|无（但可以通过互动的检查来限制可提供骑乘经验的实体）|从实体的数据包配置中获取|
|**格挡**|玩家成功用盾牌格挡伤害时触发|`格挡`(物品)|从攻击玩家的实体的数据包配置中获取|
|**技能升级**|每当玩家的等级增加时触发。该事件不用于授予经验值，而是用于奖励`Perks`系统|
|**冲刺**|玩家冲刺时，每10刻触发一次|无|在 `pmmo-server.toml` 中定义|
|**潜水**|玩家在水下时，每10刻触发一次，与其他适用的游泳事件同时触发|无|在 `pmmo-server.toml` 中配置|
|**游泳**|玩家水面上游泳时，每10刻触发一次|无|在 `pmmo-server.toml` 中配置并乘以移动速度|
|**潜水下沉**|玩家在水下并正在下沉时，每10刻触发一次|无|在 `pmmo-server.toml` 中配置并乘以移动速度|
|**浮出水面**|玩家在水下但上浮时，每10刻触发一次|无|在 `pmmo-server.toml` 中配置并乘以移动速度|
|**速泳**|玩家通过冲刺按键在水下速泳时，每10刻触发一次|无|在 `pmmo-server.toml` 中配置并乘以移动速度|
|**驯服**|成功驯服动物时触发|`驯服`(实体)|从被驯服实体的数据包配置中获取|

> 每20刻为一秒。

## 技能

> 技能是该模组的核心机制之一，它区分了玩家获取经验的方式。

> Project MMO 为每个技能设立单独的经验条。

> 你可以拥有无数个技能，且可以随意命名它们。

### 使用技能系统
- 想要使用该模组的技能系统十分简单，你只需在数据包的配置中写入技能名即可。
- 如果你在数据包中配置挖掘一个泥土获得10点经验，无论你在这个配置中放入任何技能名，玩家都会添加写入经验的等级
- - 例如，当玩家在配置中写入excavation:10，玩家会获取10点挖掘经验，但如果在此处填入whatshouldiput:10，那么则会获取该whatshouldiput技能的十点经验。
- - 这个规则适用于任何你需要填写技能配置的地方，你无需特意在某处定义该技能，只需直接在数据包与相关配置中键入它的名字即可。
- - 这个规则同时适用于`需求`与`奖励`机制
- - 但请注意，由于该规则，该模组完全使用你写入的技能来运行，这情况下combat与Combat是不同的，请注意大小写的区别。

### 如何定义技能
- 虽然前文提到了无需定义技能本身，但如果你希望技能正确地在显示在技能列表，你需要在`pmmo-Skill.toml`中进行额外的配置。
- 当玩家只通过在数据包中写入技能名如testing时，所有在游戏中显示该技能名的地方都会出现pmmo.testing这样不太美观的字样。
- 下文将针对这些问题详细描述如何翻译技能名与填写`pmmo-Skill.toml`。

#### 翻译技能名
> 如果你缺乏相关的知识，你需要参考[这个教程](https://www.bilibili.com/read/cv25731812/)来进行翻译材质包的制作。

当你需要翻译技能名时，需要依照`"pmmo.myskillname":"我翻译后的炫酷技能名"`这个格式来进行翻译。
例如`"pmmo.testing":"测试技能"`

#### 技能显示颜色与AFK惩罚
通常来说技能名默认显示为白色，如果你需要修改这一颜色的话，你需要在`pmmo-Skill.toml`中加入你自定义的技能：
```toml
[Skills.Entry.skillname]
    color = 16777215
    noAfkPenalty = false
```
- 将skillname替换为你技能的名字如testing，color后的数字换为自己想要的颜色。
- - 通常你可以在[此处](https://www.w3cschool.cn/tools/index?name=cpicker)获取颜色的hex值如cc66ff。
- - 接着，你需要通过以下的方式获取此处配置需要填写的颜色值。
- - 1. 首先你需要进入[该JS代码运行网站](https://www.wetools.com/js-run)。
- - 2. 然后你需要将之前获取的颜色hex值转化为int值。
- - 3. 通过将这个格式的代码输入进上述JS运行网站的输入区域中，然后点击输出结果。
```js
      color = 0xcc66ff // 注意此处需要在你获取的hex值前面加入0x
      console.log(color)
```
- - 4. 你就能够获取color处需要填写的数字。
`noAfkPenalty`允许你决定该技能是否免受防作弊配置(`pmmo-AntiCheese.toml`)的待机(挂机)惩罚。如果设置为true，玩家挂机时间过长时在这项技能上获得的经验也不会降低。


#### 技能组的配置选项：使用技能总和与显示组名
- 当使用技能组时，以下两个配置选项有助于调整技能组的行为：
- - 如果设置 `useTotalLevels = true`，则在计算`奖励`和`经验`时将使用各技能被分配的值，但`需求`判断将使用所有成员技能等级的总和来判断是否满足配置的需求。
- - 例如，一个总需求为100级可以通过A技能50级、B技能30级和C技能20级来满足，或者通过任何达到这个需求的技能组合。
```toml
[Skills.Entry.fighting_skills]
    noAfkPenalty = false
    useTotalLevels = true

    [Skills.Entry.fighting_skills.groupFor]
        combat = 0.5
        endurance = 0.3
        archery = 0.2
```
- - 在这个样例中，如果一个工具需要fighting_skills 50级，那么只需要combat、endurance与archery合计超过50级即可。
- - 若`useTotalLevels`为否，则需要按照分配的比例确实地将该技能组的等级提升至50级。
- `displayGroupName` 是一个选项，允许在工具提示中显示技能组名称，而不显示组成员的详细信息。
- - 对于非常大的技能组，这有助于简化工具提示的内容，但要求用户了解该技能组包含哪些技能。
#### 技能组
- 技能组是代表一组技能的标识符。
- 技能组不会显示在技能列表中，它们仅可被用于配置数据包。
- 引用上文的例子进行梳理，如果你希望将combat、endurance与archery这三项技能统一表示为一个叫做`fighting_skills`的技能组。
- 你便可以如此配置：
```toml
[Skills.Entry.fighting_skills]
    noAfkPenalty = false

    [Skills.Entry.fighting_skills.groupFor]
        combat = 0.5
        endurance = 0.3
        archery = 0.2
```
- 在这个示例中，配置显示 `fighting_skills` 由50%的combat、30%的endurance和20%的archery组成。
- 因此，如果设定`需求`为 `fighting_skills` 100，则实际需要combat 50级、endurance 30级与archery 20级。
- 此外，你可以在奖励中使用技能组，比例在这情况下会依据设置的比例来分配。
- 如果为 `fighting_skills` 设定了2.0的经验奖励，
- 则战斗技能中的combat将获得50%的额外经验，endurance获得30%的额外经验，而archery获得20%的额外经验。
- 当技能组获得经验时，组内的各个经验将根据配置的比例在所有组内的技能中分配。
> 你不需要刻意使你配置的值总和为1。模组会自动根据你输入的值来计算比例。

#### 等级上限
- 设定该技能的最高等级。
- 与全局最高等级设置不同，如果某个技能的等级上限配置低于全局配置，那么当该技能达到自身的最高等级后，即使继续获取该技能的经验，这个技能的等级也不会再增加。

#### 图标与图标尺寸
- 在技能列表中查看技能时，将显示你选择的图标。
- 你可以使用任何已加载的图标，包括那些通过材质包添加的材质，只需要确保使用正确的路径即可。其通常为模组id加文件在材质包中的路径。
- 图标允许使用除 16x16 以外的任何尺寸(但必须为正方形)。通过告诉PMMO图标的的实际边长，它可以将图标缩放到适合的大小。

#### 一个技能的完整配置示例:
使用官方的示例文件:
```toml
	[Skills.Entry]

		[Skills.Entry.magic]
			maxLevel = 2147483647
			displayGroupName = false
			useTotalLevels = false
			color = 255
			icon = "minecraft:textures/particle/enchanted_hit.png"
			iconSize = 8
			noAfkPenalty = false
```
该配置设定技能magic的最高等级为2147483647，不显示组名，不使用等级总和，255的颜色值，使用原版附魔粒子的贴图，尺寸边长为8，没有待机惩罚。

## 需求